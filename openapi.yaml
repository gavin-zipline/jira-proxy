openapi: 3.1.0
info:
  title: Jira Proxy API
  version: 1.0.0
  description: |
    Lightweight proxy that normalizes Jira Cloud issues for consumption by a Custom GPT Action.
servers:
  - url: https://shanika-ungeared-red.ngrok-free.dev
    description: Temporary tunnel for external access
  - url: http://localhost:4567
    description: Local development server
components:
  securitySchemes:
    ChatGPTApiKey:
      type: apiKey
      in: header
      name: X-API-Key
      description: Shared secret matching `CHATGPT_API_KEY`.
  responses:
    UnauthorizedError:
      description: Invalid or missing API key.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            unauthorized:
              value:
                error: Unauthorized
    JiraProxyError:
      description: Upstream Jira error.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            bad_gateway:
              value:
                error: Error talking to Jira
    IssueNotFound:
      description: Jira issue not found.
      content:
        application/json:
          schema:
            allOf:
              - $ref: "#/components/schemas/ErrorResponse"
              - type: object
                required: [key]
                properties:
                  key:
                    type: string
                    example: INT-530
          examples:
            not_found:
              value:
                error: Issue not found
                key: INT-530
  schemas:
    HealthResponse:
      type: object
      required: [ok]
      properties:
        ok:
          type: boolean
          example: true
    ErrorResponse:
      type: object
      required: [error]
      properties:
        error:
          type: string
          example: Unauthorized
    Comment:
      type: object
      required:
        - author
        - body
        - created_at
      properties:
        author:
          type: string
          nullable: true
          description: Display name of the comment author.
          example: Mike Bod√©
        body:
          type: string
          nullable: true
          description: Plain text comment body.
          example: I know you requested this add-on...
        created_at:
          type: string
          description: ISO8601 timestamp of when the comment was created.
          example: 2025-12-01T15:04:24.993-0800
    IssueResponse:
      type: object
      required:
        - key
        - summary
        - description
        - status
        - assignee
        - reporter
        - created_at
        - updated_at
        - comments
      properties:
        key:
          type: string
          example: INT-530
        summary:
          type: string
          example: Store forms consolidated to send daily
        description:
          type: string
          nullable: true
          description: Flattened description text.
        status:
          type: string
          nullable: true
          example: In Review
        assignee:
          type: string
          nullable: true
          example: Gavin Means
        reporter:
          type: string
          nullable: true
          example: Anna Collis
        created_at:
          type: string
          description: ISO8601 timestamp.
          example: 2025-12-01T04:53:35.880-0800
        updated_at:
          type: string
          description: ISO8601 timestamp.
          example: 2025-12-01T17:25:18.115-0800
        comments:
          type: array
          items:
            $ref: "#/components/schemas/Comment"
paths:
  /health:
    get:
      summary: Health check
      operationId: getHealth
      security:
        - ChatGPTApiKey: []
      responses:
        "200":
          description: Service is healthy.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"
              examples:
                ok:
                  value:
                    ok: true
        "401":
          $ref: "#/components/responses/UnauthorizedError"
  /issues/{key}:
    get:
      summary: Fetch and normalize a Jira issue
      operationId: getIssue
      security:
        - ChatGPTApiKey: []
      parameters:
        - in: path
          name: key
          required: true
          schema:
            type: string
          description: Jira issue key, e.g. `INT-530`.
      responses:
        "200":
          description: Normalized Jira issue payload.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IssueResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "404":
          $ref: "#/components/responses/IssueNotFound"
        "502":
          $ref: "#/components/responses/JiraProxyError"
